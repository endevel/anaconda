# Anaconda — Инструкция по проекту

## Обзор проекта

Anaconda — это программная реализация игры в шашки (draughts) на Python. Проект предоставляет библиотеку для работы с игровой логикой, генерацией ходов, парсингом позиций (FEN/PDN форматы) и графический интерфейс пользователя на базе PyQt6.

### Основные технологии

- **Python 3.13** — основной язык разработки
- **PyQt6** — графический интерфейс пользователя
- **pytest** — фреймворк для тестирования
- **pyproject.toml** — система сборки и управления зависимостями (современный стандарт Python)

### Архитектура проекта

Проект разделён на следующие основные модули:

- **athena/** — основная библиотека с игровой логикой
  - `core/` — базовые типы данных (BoardSize, BoardSquare, Move, Player)
  - `damboard/` — представление игровой доски
  - `movegen/` — генерация ходов (man, king)
  - `pdn/` — парсинг FEN/PDN форматов
  - `engine/` — игровой движок (в разработке)
- **gui/** — графический интерфейс на PyQt6
- **anaconda/** — точка входа приложения
- **tests/** — модульные тесты (pytest)

## Сборка и запуск

### Установка зависимостей

```bash
pip install -e .
```

### Запуск приложения

```bash
python -m anaconda
```

### Запуск тестов

```bash
pytest
```

Запуск тестов с покрытием кода:

```bash
pytest --cov=athena
```

Запуск тестов с отладочным выводом:

```bash
pytest -v -s
```

### Линтинг и форматирование

Для проверки кода используйте:

```bash
ruff check .
```

Для форматирования кода:

```bash
ruff format .
```

### Проверка типов

```bash
mypy athena/
```

## Правила разработки

### Стиль кодирования

Проект использует **Ruff** как линтер и форматировщик кода. Основные соглашения:

- Следуйте PEP 8
- Максимальная длина строки: 88 символов
- Используйте type hints для всех функций и методов
- Используйте dataclasses/frozen dataclasses для неизменяемых структур данных

### Тестирование

- Все новые функции должны быть покрыты тестами
- Тесты находятся в директории `tests/` и зеркалируют структуру `athena/`
- Используйте pytest fixtures (см. `conftest.py`)
- Напишите тесты до реализации (TDD) или сразу после кода

### Архитектурные принципы

1. **Разделение ответственности** — каждый модуль отвечает за свою часть функциональности
2. **Независимость GUI** — библиотека athena не зависит от GUI и может использоваться автономно
3. **Использование enum** — для фиксированного набора значений (Player, BoardSquare, Direction)
4. **Неизменяемость** — используйте frozen dataclasses для структур, которые не должны меняться

### Конвенции именования

- Классы: `PascalCase` (например, `BoardSize`, `StdManMoveGen`)
- Функции и методы: `snake_case` (например, `gen_std_man_move_dirs`, `parse`)
- Константы: `UPPER_CASE` (если есть)
- Приватные методы: `_leading_underscore`

### Добавление новых функций

1. Создайте соответствующий модуль в `athena/`
2. Реализуйте базовую функциональность с type hints
3. Напишите тесты в `tests/`
4. Убедитесь, что тесты проходят
5. Запустите линтер и форматировщик
6. Обновите документацию при необходимости

## Ключевые файлы

- `pyproject.toml` — конфигурация проекта, зависимости и настройки инструментов
- `athena/core/board_size.py` — определение размеров доски
- `athena/core/board_square.py` — типы клеток и фигур
- `athena/core/player.py` — перечисление игроков
- `athena/damboard/damboard.py` — основное представление игровой доски
- `athena/pdn/fen.py` — парсер FEN формата позиций
- `athena/movegen/base/std_man_movegen.py` — генерация ходов для обычных шашек
- `tests/` — модульные тесты для всех компонентов

## Структура директорий

```
.
├── .github/              # GitHub Actions workflows
├── anaconda/             # Точка входа приложения
├── athena/               # Основная библиотека
│   ├── core/            # Базовые типы данных
│   ├── damboard/        # Представление доски
│   ├── movegen/         # Генерация ходов
│   ├── pdn/             # Парсинг PDN/FEN
│   └── engine/          # Игровой движок
├── gui/                 # Графический интерфейс (PyQt6)
├── res/                 # Ресурсы (изображения, иконки)
├── tests/               # Модульные тесты
├── pyproject.toml       # Конфигурация проекта
└── README.md            # Документация
```

## Дополнительная информация

### Python версия

Проект требует Python 3.13 (см. `.python-version`).

### CI/CD

GitHub Actions настроен для автоматического запуска тестов и проверки кода (см. `.github/workflows/`).

### TODO

- Реализовать полный игровой движок в `athena/engine/`
- Добавить поддержку PDN формата для записи партий
- Расширить покрытие тестами
- Добавить интеграционные тесты
